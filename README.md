# 토비의 스프링 3.1
## 토비의 스프링 정리
  - 개인적인 토비의 스프링 저장 공간입니다. 
  - 자세한 사항은 토비의 스프링 3.1을 참고 하시면 감사하겠습니다.

## 1장 오브젝트와 의존관계
### 초난감 DAO
  - 스프링이 가장 관심을 두는 대사은 오브젝트다. 
  - 오브젝트 설계과 구현에 관한 여러가지 응용 기술과 지식이 요구 된다.
    - 객체지향 설계
    - 디자인 패턴 : 다양한 목적을 위해 재활용
    - 리팩토링 : 더 깔끔 한 구조가 되도록 개선 작업
    - 단위테스트 : 오브젝트가 기대한 대로 동작하는지 검증
  - 자바빈
    - 비주얼 툴에서 조작 가능한 컴포넌트. 
    - 디폴트 생성자 : 자바 빈은 파라미터가 없는 디폴터 생성자를 가지고 있어야 한다. 툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문
    - 프로퍼티 : 자바빈이 노출하는 이름을 가진 속성. set으로 시작하는 수정자 메서드. 
  - JDBC 작업 순서
    - DB연결위한 Connection 가져옴
    - SQL을 담는 Statement를 만듬
    - 만들어진 statement 실행
    - 조회의 경우 SQL쿼리 실행결과를 ResultSet으로 받아 정보 저장할 오브젝트에 옮겨 줌. 
    - 작업 중에 생성된 Connection, Statement, Resultset 등의 리소스를 작업 마친 후 반드시 닫아줌. 
    - 예외를 처리 함. 
  - DAO 클래스가 정상 동작하는지 확인 방법은 웹 애플리케이션을 서버에 배치하고, 웹 브라우저를 통해 DAO 기능을 사용해 보는 것이다. 
    - 배보다 배꼽이 더 큰 일 이 된다. 
  - main()을 이용한 DAO 테스트 코드
    
### DAO의 분리
  - 관심사의 분리
    - 분리와 확장을 고려한 설계로 변경이 일어 났을 때 필요한 작업을 최소화 하고, 그 변경이 다른 곳에 문제를 일으키지 않게 할 수 있따. 
    - 관심이 같은 것끼리는 모으고, 관심이 다른것은 따로 떨어져 있게 한다. 
    - '관심사의 분리' : 관심이 같은 것끼리는 하나의 객체 안으로 또는 책한 객체로 모이게 하고, 관심이 다른 것은 가능한 따로 떨어져 서로 영향을 주지 않도록 분리.
    - 한가지 관심에 대한 변경이 일어난 경우, 그 관심이 집쭝되는 부분의 소스코드만 수정하면 된다. 
    - 리펙토링의 메서드 추출
        - 공통의 기능을 담당하는 메서드로 중복된 코드를 뽑아내는 것.
    - 상속을 통해 관심사항을 분리할 수 있다. 
    - 템플릿 메서드 패턴
        - 슈퍼클래스에 기본적인 로직의 흐름을 만들고, 그 기능의 일부를 추상 메서드나 오버라이딩 가능한 protected 메서드 등으로 만든 뒤 서브 클래스에서 이 메서드를 필요에 맞게 구현해 사용하도록 하는 것. 
    - 팩토리 메서드 패턴
        - 서브 클래스에서 구체적인 오브젝터 생성방법을 결정하게 하는 것. 
  - 상속을 사용한 분리의 문제점
    - 다중상속의 문제가 발생할 수 있다.
    - 상속을 통한 상하위 클래스의 관게가 생각보다 밀접해 진다. 

### DAO의 확장
  - 클래스의 분리(완전히 독립적인 클래스로)
    - 상속으로 클래스를 분리하면 두가지 문제가 발생한다.
        - makeNewConnection이 다른 매서드 명 openConnection()으로 바뀐다면 일일이 다 변경해 줘야 한다. 
        - DB 커넥션을 제공하는 클래스가 어떤 것인지 UserDao가 구체적으로 알고 있어야 한다. 
    - 두 개의 클래스가 서로 긴밀하게 연결되지 않도록 중간에 추상적인 느슨한 연결고리를 만들어 준다. (인터페이스))
        - UserDao 입장에서 어떤 클래스로 ConnectionMaker가 만들어 졌는지 알 필요가 없어진다. 
        - 생성자에서 conntiontionMaker = new DConnectionMaker(); 라는 특정 클래스를 지정하는 문제가 남아있다. 
  - 관계설정 책임의 분리
    - 외부에서 만들어진 오브젝트를 전달받으려면 메서드 파라미터나 생성자 파라미터를 이용하면 된다. 
    - UserDao가 DConnectoinMaker를 알게 해선 안된다. 
    - 객체지향 다형성의 특징으로 코드에서 특정 클래스를 전혀 알지 못하더라도 해당클래스가 구현한 인터페이스를 사용하면 그 클래스의 오브젝트를 인터페이스 타입으로 받을 수 있다. 
    - UserDao 클라이언트는 런타임 오브젝트 관계를 갖는 구조로 만들어 줄 수 있다. 
    - 인터페이스를 도입하고 클라이언트의 도움을 얻은 방법은 상속을 사용했을 떄 보다 유연해졌다. 
  - 원칙과 패턴
    - 클래스나 모듈은 확장에 열려있고 변경에는 닫혀있어야 한다. 
        - 인터페이스를 통해 제공되는 확장 포인트는 확장을 위해 개방되 있어야한다.
        - 인터페이스를 이용하는 클래스는 자신의 변화가 불필요하게 일어나지 않도록 폐쇄 되어 있다.
    - 개방 폐쇄 원칙은 높은 응집도와 낮은 결합도 라는 소프트웨어 개발 원리로 설명 가능하다. 

### 제어의 역전(IoC)
  - 팩토리
    - 객체의 생성 방법을 결정하고 그렇게 만들어진 오브젝트를 돌려주는 것. 
  - 템플릿 메서드는 제어의 역전이라는 개념을 활용해 문제를 해결하는 디자인 패턴이다. 
    - 프레임 워크는 제어의 역전 개념이 적용되있어야 한다. 애플리케이션 코드는 프레임워크가 짜놓은 틀에서 수동적으로 동작해야 한다. 
  - 스프링은 IoC를 모든 기능의 기초가 되는 기반기술로 삼고 있고, IoC를 극한까지 적용하고 있는 프레임워크다.   

### 스프링 IoC
  - 오브젝트 팩토리를 이용한 스프링 IoC
    - 스프링 빈은 제어의 역전이 적용된 오브젝트를 가리킨다. 
    - 스플이에서 빈의 생성과 관계설정 같은 제어를 담당하는 IoC 오브젝트를 빈 팩토리 라고 부른다. 어플케이션 컨텍스트라고 주로 부른다. 스프링 컨테이너라고도 함.
    - @Configuration으로 DaoFactory를 스프링이 빈 팩토리를 위한 오브젝트 설정을 담당하는 클래스라고 인식하게 하자. 
    - 메서드에는 @Bean을 붙여준다. 
    - 애플리케이션 컨텍스트는 ApplicationContext를 구현한 것이다. 
    - getBean()은 기본적으로 Object 타입으로 리턴하게 되있어 매번 리턴되는 오브젝트에 다시 캐스팅 해줘야 하는 부담이 있다. 
      - 제네릭 메서드 방식을 사용해 두번쨰 파라미터에 리턴 타입을 줌으로 해결 할 수 있다. 
  
  - 애플리케이션 컨텍스트의 동작방식
    - ApplicationContext는 빈 팩토리가 구현하는 BeanFoactory 인터페이스를 상속했으므로 일종의 빈 팩토리인 셈이다. 
    - DaoFactory를 오브젝트 팩토리로 직접 사용했을 떄 비해 애플리케이션 컨텍스트를 사용했을 때 얻는장점
      - 클라이언트는 구첵적인 팩토리 클래스를 알 필요가 없다. 
      - 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해 준다. 
      - 빈을 검색하는 다양한 방법을 제공한다. 

  - 스프링 IoC의 용어 정러
    - 빈 : 스프링이 IoC 방식으로 관리하는 오브젝트라는 뜻.스프링이 직접 그 생성과 제어를 담당하는 오브젝트만 빈이라고 부른다..
    - 빈 팩토리 : 스프링의 IoC를 담당하는 핵심 컨테이너. 빈을 관리함. BeanFactory를 확장한 애플리케이션 컨텍스트를 주로 이용한다. 
    - 애플리케이션 컨텍스트 : 빈 팩토리를 확장한 IoC 컨테이너. 스프링이 제공하는 각종 부가 서비스를 추가로 제공함. 
    - 설정정보 / 설정 메타정보 : 애플리케이션 켄텍스트 또는 빈팩토리가 IoC를 적용하기 위해 사용하는 메타 정보. configuration.
    - 컨테이너 or IoC 컨테이너 : IoC 방식으로 빈을 관리한다는 의미에서 애플리케이션 컨텍스트나 빈 팩토리를 컨테이너 또는 IoC 컨테이너라고 한다. 
    - 스프링 프레임워크 : 스프링이 제공하는 모든 기능을 통틀어 말할 때 주로 사용. 줄여서 스프링 이라고 말하기도 함.

### 싱글톤 레지스트리와 오브젝트 스코프
  - 스프링은 여러번 걸쳐 빈을 요청하더라도 매번 동일한 오브젝트를 돌려준다. 
  - 싱글톤 레지스터리로서의 애플리케이션 컨텍스트
    - 매번 새로 만들게 되면 수많은 요청이 오게 된다면 부학 발생한다. 
    - 서블릿은 서비스 오브젝트 기술중 하나인데, 서블릿은 대부분 멀티스레드 환경에서 싱글톤으로 동작한다. 
    - 서버 환경에서 싱글톤의 사용이 권장된다. 
    - 싱글톤 구현의 문제점
      - private 생성자라 상속할 수 없다. 객체지향적인 장점이 없어진다. 
      - 테스트 하기 어렵다. 
      - 서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다. 
      - 싱글콘의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다. 
    - 싱글톤 레지스트리
      - 스프링은 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공한다. 바로 싱글톤 레지스트리라 부른다. 
      - public한 생성자를 가질 수 있다. 
      - 테스트 환경에서도 자유롭다. 
      - 스프링은 IoC 컨테이너일 뿐만아니라 싱글톤 레지스트리 이다. 
  - 싱글톤 오브젝트의 상태
    - 싱글톤은 동시접근이 가능해 상태 관리에 주의해야한다. 
    - 싱글톤은 기본적으로 인스턴스 필드의 값을 변경하고 유지하는 생태유지 방식으로 만들지 않는다. 
    - 파라미터와 로컬변수, 리턴 값등을 이용해 리소스로부터 생성한 정보를 다룰 수 있다. 
    - 자신이 사용하는 다른 싱글톤 빈을 저장하려는 용도라면 인스턴스 변수를 사용해도 좋다. 

### 의존관계 주입(DI)
  - 제어의 역전과 의존성 관계 주입
    - DI는 오브젝트 레퍼런스를 외부로부터 제공받고 이를 통해 여타 오브젝트와 다이내믹하게 의존관게를 만드는 것이 핵심이다. 
  - 런타임 의존관계 설정
    - 두 클래스 또는 모듈이 의존관계 있다고 할때 항상 방향성을 부여해 줘야 한다. 
    - A --> B 있을때 B가 변하면 그것이 A에 영향을 미친다는 의미이다. 
    - 인터페이스에 대해서만 의존관계를 만들어 주면 인터페이스를 구현한 클래스와의 관계는 느슨해져 결합도가 낮아지게 된다. (모델링 의존관계 시점)
    - 의존관계 주입은 구체적인 의존 오브젝트와 그것을 사용할 주체, 보통 클라이언트라고 부르는 오브젝트를 런타임 시 연결해 주는 작업을 말한다. 
    - DAOFactory는 런타임 시점에 UserDao가 사용할 ConnectionMaker 타입의 오브젝트를 결정하고, 이를 생성 후 의존 관계를 맺는다. 
  - 의존관계 검색과 주입
    - 의존관계 검색은 자신이 필요로 하는 의존 오브젝트를 능동적으로 찾는다. 
    - getBean()으로 의존관계 검색에 사용된다. 
    - 의존관계 검색 보다는 의존관계 주입 방식을 사용하는 편이 더 낫다. 
    - 의존관계 검색이 필요한 시점은 애플리케이션 기동 시점에 적어도 한번 사용해야 한다. 스태틱 메서드인 main()에서 DI를 이용해 오브젝트를 주입 받는 방법이 없기 때문에이다.
    - 의존 관계 검색 방식에선 검색하는 오브젝트는 자신이 스프링 빈일 필요가 없다. 
    - 의존관계주입(DI)는 원하는 오브젝트는 먼저 자기 자신이 컨테이너가 관리하는 빈이 돼야 한다. 
      - 주입은 다이내믹하게 구현 클래스를 결정해서 제공받을 수 있도록 인터페이스 타입의 파라미터를 통해 이뤄져야 한다. 
  - 의존관계 주입의 응용
    - 개발환경과 운영환경에서 DI의 설정정보에 해당하는 DaoFactory만 다르게 만들어 두면 나머지 코드엔 손대지 않고 개발 시와 운영 시 각각 다른 런타임 오브젝트에 의존관계를 가지게 할 수 있다. 
  - 메서드를 이용한 의존관계 주입
    - 수정자 메서드를 이용한 주입
      - 외부에서 오브젝트 내으의 애프리뷰트 값을 변경하려는 용도로 주로 사용된다. 
      - 메서드는 set으로 시작. 
    - 일반 메서드를 이용한 주입
      - set으로 시작해야 하고 여러개의 파라미터를 갖을 수도 있다. 
    - 스프링은 메서드를 이용한 DI 방법중 수정자 메서드를 가장 많이 사용해 왔다. 

### DataSource 인터페이스로 변환
  - 자바에는 DataSource 라는 인터페이스가 존재한다. 
  - 일반적으론 DataSource를 구현해 DB커넥션을 제공하는 클래스를 만들 일은 거의 없다. 다양한 DB연결과 풀링 기능을 갖춘 많은 DataSource 구현 클래스가 존재하기 때문.
  - DataSource에서 고나심을 가질 것은 getConnection() 메서드 하나 뿐이다. 





